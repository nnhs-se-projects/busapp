<div class="header">
    <div class="weather-container">    
        <div class="weather-temperature">
            <p><%= data.weather.temperature %>Â°F</p>
        </div>
        <div class="weather-status">
            <p><%= data.weather.status %> </p>
        </div>
        <div class="weather-img">
            <img src=<%= data.weather.icon %>>
        </div>
    </div>
    <!--
    <div class="notif-container">
        <a id="notif-notice" onclick="requestNotificationPermission()"><i class="fa-solid fa-bell"></i></a>
    </div>
    -->
    <div class="buttons-container">
        <div class="login-container">
            <a id="login-button" href="/admin">Admin</a>
        </div>
        <div class="help-container">
            <a class="help-button" href="/help">Help</a>
        </div>
    </div>
</div>
<div class="tables-container">
    <% if(announcement != "") { %>
        <table class="announcement-table" id="announcement-table">
            <thead>
                <tr>
                    <th class="announcement-table"><i class="fa-solid fa-bullhorn fa-fw"></i> Announcement</th>
                </tr>
            </thead>
            <tbody>
                <td class="announcement"><%= announcement %></td>
            </tbody>
        </table>
    <% } %>
    <div id="buses">
        <!-- pins -->
        <table class="bus-table" id="pin-bus-table">
            <thead>
                <tr>
                    <th colspan="4" style="background-color: #bf2214; font-size: 160%;"><i class="fa-solid fa-thumbtack fa-fw"></i> Pinned Buses</th>
                </tr>
                <tr>
                    <th class="num-col">Bus # &rarr; Change</th>
                    <th class="status-col">Status</th>
                    <th class="time-col">Time</th>
                    <th class="pin-col">Pin?</th>
                </tr>
            </thead>
            <tbody id="pin-bus-rows">
            <% for(let i = 0; i < data.buses.length; i++) { %>
                <tr>
                    <td class="num-col"><%= data.buses[i].number %> <% if (data.buses[i].change) { %> &rarr; <%= data.buses[i].change %></span><% } %></td>
                    <td class="status-col"><%= data.buses[i].status ? data.buses[i].status : "Not Here" %></td>
                    <td class="time-col"><%= data.buses[i].time ? data.buses[i].time.toLocaleTimeString([], { timeZone: 'America/Chicago',  hour: '2-digit', minute: '2-digit', hour12: true }) : "" %></td>
                    <td class="pin-col"><button class="pin-button" style="background-color: #bf2214" onclick="pinBus(this)"><i class="fa-solid fa-thumbtack"></i> Unpin</button></td>             
                </tr>
            <% } %> 
                <tr>
                    <td colspan="4" style="text-align:center">No buses pinned.</td>
                </tr>
            </tbody>
        </table>

        <% if (data.isLocked === true) { %>
            <div class="timer-box">
                <p id="timer" class="timer-text"></p>
            </div>
        <% } %>

        <!-- all buses -->
        <table class="bus-table" id="all-bus-table">
            <thead>
                <tr>
                    <th colspan="4" style="background-color: #05a1f5; font-size: 160%;"><i class="fa fa-star fa-fw"></i> All Buses</th>
                </tr>
                <tr>
                    <th class="num-col">Bus # &rarr; Change</th>
                    <th class="status-col">Status</th>
                    <th class="time-col">Time</th>
                    <th class="pin-col">Pin?</th>
                </tr>
            </thead>
            <tbody id="all-bus-rows">
            <% for(let i = 0; i < data.buses.length; i++) { %> 
                <tr>
                    <td class="num-col"><%= data.buses[i].number %> <% if (data.buses[i].change) { %> &rarr; <%= data.buses[i].change %></span><% } %></td>
                    <td class="status-col"><%= data.buses[i].status ? data.buses[i].status : "Not Here" %></td>
                    <td class="time-col"><%= data.buses[i].time ? data.buses[i].time.toLocaleTimeString([], { timeZone: 'America/Chicago',  hour: '2-digit', minute: '2-digit', hour12: true }) : "" %></td>
                    <td class="pin-col"><button class="pin-button" onclick="pinBus(this)"><i class="fa-solid fa-thumbtack"></i> Pin</button></td>
                </tr>
            <% } %> 
            </tbody>
        </table>
    </div>
    
</div>
<p style="color: #006678; font-size: 100%; text-align: center;">Credits: Pierre Hanlet, JD Piar, Varun Vaid, Maaz Zubair, Sayee Anand, Wyatt Barnes, Kurt Lovisa, Nolan Yee, Devam Das, Ronith Manikonda, Everett Dombrowski, Rohan Rao</p>

<!-- <p id="contactInfo">
    If you have feedback, feature requests or bugs to report please contact busappnnhsse@gmail.com. 
    Please include the topic of the email in the subject.
</p> -->

<script>
    // Set the date we're counting down to
    

    // Update the count down every 1 second
    var x = setInterval(async function() {
        var countDownDate; // Define the countDownDate variable

        await fetch('/leavingAt')
        .then(response => response.json())
        .then(data => {
            // convert the data string to a date object
            const leavingAt = new Date(data);
            
            countDownDate = leavingAt; // Assign the value to countDownDate
            // console.log(leavingAt)

        })
        .catch(error => {
            console.error('Error:', error);
        });
        // Get today's date and time
        var now = new Date().getTime();

        // Find the distance between now and the count down date
        var distance = countDownDate - now;

        // Time calculations for days, hours, minutes and seconds
        var days = Math.floor(distance / (1000 * 60 * 60 * 24));
        var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        var seconds = Math.floor((distance % (1000 * 60)) / 1000);

        // Output the result in an element with id="demo"
        document.querySelectorAll("[id=timer]").forEach((element) => {
            element.innerHTML = "The current wave will leave in " + minutes + "min " + seconds + "sec ";
        });

        // If the count down is over, write some text 
        if (distance < 0) {
            clearInterval(x);
            document.querySelectorAll("[id=timer]").forEach((element) => {
                element.innerHTML = "The current wave is about to leave!";
            });
        }
    }, 1000);
</script>